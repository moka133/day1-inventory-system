<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>상품 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1>상품 재고 관리</h1>

    <div class="mb-3">
        <a href="/products/new" class="btn btn-primary">상품 등록</a>
    </div>

    <table class="table table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>상품명</th>
            <th>가격</th>
            <th>재고</th>
            <th>등록일</th>
            <th>작업</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="product : ${products}">
            <td th:text="${product.id}"></td>
            <td th:text="${product.name}"></td>
            <td th:text="${product.price}"></td>
            <td th:text="${product.stock}"
                th:classappend="${product.stock < 10} ? 'text-danger fw-bold' : ''"></td>
            <td th:text="${#temporals.format(product.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
            <td>
                <button class="btn btn-sm btn-success"
                        th:onclick="|addStock(${product.id})|">입고</button>
                <button class="btn btn-sm btn-warning"
                        th:onclick="|removeStock(${product.id})|">출고</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    function addStock(productId) {
        const quantity = prompt("입고할 수량을 입력하세요:");
        if (!quantity || quantity <= 0) {
            alert("올바른 수량을 입력하세요.");
            return;
        }

        fetch(`/api/products/${productId}/add-stock?quantity=${quantity}`, {
            method: 'POST'
        })
        .then(response => response.text())
        .then(message => {
            alert(message);
            location.reload();
        })
        .catch(error => {
            console.error('Error:', error);
            alert("오류가 발생했습니다.");
        });
    }

    function removeStock(productId) {
        const quantity = prompt("출고할 수량을 입력하세요:");
        if (!quantity || quantity <= 0) {
            alert("올바른 수량을 입력하세요.");
            return;
        }

        fetch(`/api/products/${productId}/remove-stock?quantity=${quantity}`, {
            method: 'POST'
        })
        .then(response => {
            if (response.ok) {
                return response.text();
            } else {
                throw new Error('출고 실패');
            }
        })
        .then(message => {
            alert(message);
            location.reload();
        })
        .catch(error => {
            alert("출고에 실패했습니다. 재고를 확인하세요.");
        });
    }
</script>
</body>
</html>